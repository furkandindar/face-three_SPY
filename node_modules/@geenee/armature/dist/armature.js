import{EventEmitter as S}from'events';var B=function(Y,A){return B=Object['setPrototypeOf']||{'__proto__':[]}instanceof Array&&function(J,K){J['__proto__']=K;}||function(J,K){for(var F in K)Object['prototype']['hasOwnProperty']['call'](K,F)&&(J[F]=K[F]);},B(Y,A);};function Z(Y,A){if('function'!=typeof A&&null!==A)throw new TypeError('Class\x20extends\x20value\x20'+String(A)+'\x20is\x20not\x20a\x20constructor\x20or\x20null');function J(){this['constructor']=Y;}B(Y,A),Y['prototype']=null===A?Object['create'](A):(J['prototype']=A['prototype'],new J());}var G=function(){return G=Object['assign']||function(Y){for(var A,J=0x1,K=arguments['length'];J<K;J++)for(var F in A=arguments[J])Object['prototype']['hasOwnProperty']['call'](A,F)&&(Y[F]=A[F]);return Y;},G['apply'](this,arguments);};function H(Y,A,J,K){return new(J||(J=Promise))(function(F,E){function P(o1){try{o0(K['next'](o1));}catch(o2){E(o2);}}function X(o1){try{o0(K['throw'](o1));}catch(o2){E(o2);}}function o0(o1){var o2;o1['done']?F(o1['value']):(o2=o1['value'],o2 instanceof J?o2:new J(function(o3){o3(o2);}))['then'](P,X);}o0((K=K['apply'](Y,A||[]))['next']());});}function V(Y,A){var J,K,F,E,P={'label':0x0,'sent':function(){if(0x1&F[0x0])throw F[0x1];return F[0x1];},'trys':[],'ops':[]};return E={'next':X(0x0),'throw':X(0x1),'return':X(0x2)},'function'==typeof Symbol&&(E[Symbol['iterator']]=function(){return this;}),E;function X(o0){return function(o1){return function(o2){if(J)throw new TypeError('Generator\x20is\x20already\x20executing.');for(;P;)try{if(J=0x1,K&&(F=0x2&o2[0x0]?K['return']:o2[0x0]?K['throw']||((F=K['return'])&&F['call'](K),0x0):K['next'])&&!(F=F['call'](K,o2[0x1]))['done'])return F;switch(K=0x0,F&&(o2=[0x2&o2[0x0],F['value']]),o2[0x0]){case 0x0:case 0x1:F=o2;break;case 0x4:return P['label']++,{'value':o2[0x1],'done':!0x1};case 0x5:P['label']++,K=o2[0x1],o2=[0x0];continue;case 0x7:o2=P['ops']['pop'](),P['trys']['pop']();continue;default:if(!(F=P['trys'],(F=F['length']>0x0&&F[F['length']-0x1])||0x6!==o2[0x0]&&0x2!==o2[0x0])){P=0x0;continue;}if(0x3===o2[0x0]&&(!F||o2[0x1]>F[0x0]&&o2[0x1]<F[0x3])){P['label']=o2[0x1];break;}if(0x6===o2[0x0]&&P['label']<F[0x1]){P['label']=F[0x1],F=o2;break;}if(F&&P['label']<F[0x2]){P['label']=F[0x2],P['ops']['push'](o2);break;}F[0x2]&&P['ops']['pop'](),P['trys']['pop']();continue;}o2=A['call'](Y,P);}catch(o3){o2=[0x6,o3],K=0x0;}finally{J=F=0x0;}if(0x5&o2[0x0])throw o2[0x1];return{'value':o2[0x0]?o2[0x1]:void 0x0,'done':!0x0};}([o0,o1]);};}}var D=function(Y){function A(){return null!==Y&&Y['apply'](this,arguments)||this;}return Z(A,Y),A;}(S),L=(function(){function Y(A){void 0x0===A&&(A='canvas'),this['size']={'width':0x0,'height':0x0},this['context']=null,this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.capture.'+A,this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}return Y['prototype']['capture']=function(A){var J=this['context'];if(!J)return!0x1;var K=this['size'],F=K['width'],E=K['height'];return J['drawImage'](A,0x0,0x0,F,E),!0x0;},Y['prototype']['image']=function(){var A=this['context'];if(A){var J=this['size'],K=J['width'],F=J['height'];return A['getImageData'](0x0,0x0,K,F);}},Y['prototype']['setSize']=function(A){this['size']=G({},A),this['canvas']['width']=A['width'],this['canvas']['height']=A['height'];},Y['prototype']['dispose']=function(){this['context']=null,this['canvas']['remove']();},Y;}()),Q=function(Y){function A(J){var K=Y['call'](this)||this;return K['params']=J,K['captureTime']=0x0,K['setup']=function(F){return H(K,void 0x0,void 0x0,function(){var E,P,X,o0,o1,o2,o3=this;return V(this,function(o4){switch(o4['label']){case 0x0:return this['params']=F||this['params'],E=function(o5){return'getVideoTracks'in o5;},P=function(o5){return!E(o5)&&'video'in o5;},X=function(o5){if(!o5)return{'video':!0x0,'audio':!0x1};if(P(o5))return o5;var o6=o5['size'];return{'video':{'facingMode':o5['rear']?'environment':'user','width':null==o6?void 0x0:o6['width'],'height':null==o6?void 0x0:o6['height']},'audio':!0x1};},this['params']&&E(this['params'])?[0x3,0x2]:[0x4,navigator['mediaDevices']['getUserMedia'](X(this['params']))['catch'](function(){})];case 0x1:return o1=o4['sent'](),[0x3,0x3];case 0x2:o1=this['params'],o4['label']=0x3;case 0x3:return(o0=o1)?(o2=this['videoRef'],[0x2,new Promise(function(o5){o2['onloadedmetadata']=function(){o3['updateSize']({'width':o2['videoWidth'],'height':o2['videoHeight']}),o2['onresize']=function(){o3['updateSize']({'width':o2['videoWidth'],'height':o2['videoHeight']});},o5(!0x0);},o2['srcObject']=o0;})]):[0x2,!0x1];}});});},K['dispose']=function(){K['reset'](),K['videoRef']['remove'](),K['captureCtx']['dispose']();},K['start']=function(){return H(K,void 0x0,void 0x0,function(){return V(this,function(F){switch(F['label']){case 0x0:return this['captureTime']=0x0,this['videoRef']['srcObject']?[0x4,this['videoRef']['play']()]:[0x3,0x2];case 0x1:F['sent'](),F['label']=0x2;case 0x2:return[0x2];}});});},K['pause']=function(){K['videoRef']['pause']();},K['reset']=function(){K['pause'](),K['videoRef']['srcObject']&&(K['videoRef']['srcObject']['getTracks']()['forEach'](function(F){return F['stop']();}),K['videoRef']['srcObject']=null);},K['capture']=function(){var F=K,E=F['videoRef'],P=F['captureCtx'];return!(E['currentTime']<=K['captureTime'])&&(K['captureTime']=E['currentTime'],P['capture'](E));},K['videoRef']=document['createElement']('video'),K['videoRef']['id']='engeenee.capture.source',K['videoRef']['hidden']=!0x0,K['videoRef']['playsInline']=!0x0,K['captureCtx']=new L('capture'),K;}return Z(A,Y),A['prototype']['context']=function(){return this['captureCtx'];},A['prototype']['size']=function(){return this['captureCtx']['size'];},A['prototype']['ratio']=function(){var J=this['captureCtx']['size'];return J['width']/J['height'];},A['prototype']['updateSize']=function(J){this['captureCtx']['setSize'](J),this['emit']('resize',this['captureCtx']['size']);},A;}(D),M=function(Y){function A(J,K){var F=Y['call'](this)||this;return F['engineParams']=K,F['renderers']=[],F['videoRatio']=0x780/0x438,F['streamSize']={'width':0x780,'height':0x438},F['processSize']={'width':0x780,'height':0x438},F['resizeEnabled']=!0x1,F['loopState']=!0x1,F['init']=function(E){return H(F,void 0x0,void 0x0,function(){var P;return V(this,function(X){switch(X['label']){case 0x0:return[0x4,this['setupProcessor'](E)];case 0x1:return P=X['sent'](),this['emit']('init',P),[0x2,P];}});});},F['setup']=function(E){return H(F,void 0x0,void 0x0,function(){var P;return V(this,function(X){switch(X['label']){case 0x0:return this['pause'](),[0x4,this['setupVideo'](E)];case 0x1:return P=X['sent'](),this['emit']('setup',P),[0x2,P];}});});},F['start']=function(){return H(F,void 0x0,void 0x0,function(){return V(this,function(E){switch(E['label']){case 0x0:return[0x4,this['video']['start']()];case 0x1:return E['sent'](),this['loopState']=!0x0,this['emit']('start'),this['enqueue'](),[0x2];}});});},F['pause']=function(){F['loopState']=!0x1,F['loopId']&&(window['cancelAnimationFrame'](F['loopId']),delete F['loopId']),F['video']['pause'](),F['emit']('pause');},F['reset']=function(){F['pause'](),F['video']['reset'](),delete F['streamCanvas'],delete F['processCanvas'],F['processor']['reset']();},F['iterate']=function(){return H(F,void 0x0,void 0x0,function(){var E,P,X,o0,o1,o2;return V(this,function(o3){switch(o3['label']){case 0x0:return P=(E=this)['video'],X=E['streamCanvas'],o0=E['processCanvas'],P['capture']()&&X&&o0?(this['resizeEnabled']&&(null===(o2=this['resizeContext'])||void 0x0===o2||o2['capture'](P['context']()['canvas'])),[0x4,this['processor']['process'](o0,P['captureTime'])]):[0x2,this['enqueue']()];case 0x1:return o1=o3['sent'](),o1?[0x4,Promise['all'](this['renderers']['map'](function(o4){return o4['update'](o1,X);}))]:[0x3,0x3];case 0x2:o3['sent'](),o3['label']=0x3;case 0x3:return this['enqueue'](),[0x2];}});});},F['processor']=new J(),F['video']=new Q(),F['video']['on']('resize',F['resizeVideo']['bind'](F)),F;}return Z(A,Y),A['prototype']['addRenderer']=function(J){return H(this,void 0x0,void 0x0,function(){return V(this,function(K){switch(K['label']){case 0x0:return this['renderers']['push'](J),[0x4,J['load']()];case 0x1:return K['sent'](),J['setupVideo'](this['video']['size'](),this['video']['ratio']()),J['setupCamera'](this['processor']['cameraRatio'],this['processor']['cameraAngle']),[0x2];}});});},A['prototype']['removeRenderer']=function(J){var K=this['renderers'],F=K['indexOf'](J);F<0x0||(K[F]['dispose'](),K['slice'](F,0x1));},A['prototype']['enqueue']=function(){this['loopId']=this['loopState']?window['requestAnimationFrame'](this['iterate']):void 0x0;},A['prototype']['setupProcessor']=function(J){var K;return H(this,void 0x0,void 0x0,function(){var F;return V(this,function(E){return F=this['resizeEnabled']&&(null===(K=this['resizeContext'])||void 0x0===K?void 0x0:K['size'])||this['video']['size'](),[0x2,this['processor']['init'](J,F,this['video']['ratio']())];});});},A['prototype']['setupVideo']=function(J){return H(this,void 0x0,void 0x0,function(){return V(this,function(K){switch(K['label']){case 0x0:return this['video']['reset'](),[0x4,this['video']['setup'](J)];case 0x1:return K['sent']()?(this['setupSize'](this['video']['size']()),[0x2,!0x0]):[0x2,!0x1];}});});},A['prototype']['setupSize']=function(J){var K,F;return H(this,void 0x0,void 0x0,function(){var E,P,X,o0,o1;return V(this,function(o2){return E=J['width'],P=J['height'],this['videoRatio']=E/P,X=Math['max'](E,P),o0=(null===(K=this['engineParams'])||void 0x0===K?void 0x0:K['max'])||this['processor']['optimalSize'],this['resizeEnabled']=!0x1,o0<X&&(this['resizeEnabled']=!0x0,o1=X/o0,this['resizeContext']||(this['resizeContext']=new L('resize')),this['resizeContext']['setSize']({'width':E/o1,'height':P/o1})),this['resizeEnabled']&&this['resizeContext']?(this['processCanvas']=this['resizeContext']['canvas'],this['processSize']=this['resizeContext']['size']):(this['processCanvas']=this['video']['context']()['canvas'],this['processSize']=this['video']['context']()['size']),!0x1!==(null===(F=this['engineParams'])||void 0x0===F?void 0x0:F['orig'])?(this['streamCanvas']=this['video']['context']()['canvas'],this['streamSize']=this['video']['context']()['size']):(this['streamCanvas']=this['processCanvas'],this['streamSize']=this['streamSize']),[0x2];});});},A['prototype']['resizeVideo']=function(J){var K=this;this['setupSize'](J),this['processor']['setupVideo'](this['processSize'],this['videoRatio']),this['renderers']['forEach'](function(F){return F['setupVideo'](K['streamSize'],K['videoRatio']);}),this['renderers']['forEach'](function(F){return F['setupCamera'](K['processor']['cameraRatio'],K['processor']['cameraAngle']);});},A;}(D),I=function(Y){function A(){var J=null!==Y&&Y['apply'](this,arguments)||this;return J['iterate']=function(){return H(J,void 0x0,void 0x0,function(){var K,F,E,P,X,o0,o1;return V(this,function(o2){switch(o2['label']){case 0x0:return F=(K=this)['video'],E=K['streamCanvas'],P=K['processCanvas'],E&&P?(o0=this['result'])?[0x4,this['result']]:[0x3,0x2]:[0x2,this['enqueue']()];case 0x1:o0=o2['sent'](),o2['label']=0x2;case 0x2:return void 0x0===(X=o0)?[0x3,0x4]:[0x4,Promise['all'](this['renderers']['map'](function(o3){return o3['update'](X,E);}))];case 0x3:o2['sent'](),o2['label']=0x4;case 0x4:return F['capture']()?(this['resizeEnabled']&&(null===(o1=this['resizeContext'])||void 0x0===o1||o1['capture'](F['context']()['canvas'])),this['result']=this['processor']['process'](P,F['captureTime']),this['enqueue'](),[0x2]):(delete this['result'],[0x2,this['enqueue']()]);}});});},J;}return Z(A,Y),A;}(M),W=function(Y){function A(){var J=Y['call'](this)||this;return J['params']={},J['videoSize']={'width':0x780,'height':0x438},J['videoRatio']=J['videoSize']['width']/J['videoSize']['height'],J['optimalSize']=0x400,J['cameraRatio']=J['videoRatio'],J['cameraAngle']=0x3c/0xb4*Math['PI'],J;}return Z(A,Y),A['prototype']['process']=function(J,K){return H(this,void 0x0,void 0x0,function(){return V(this,function(F){return[0x2];});});},A['prototype']['init']=function(J,K,F){return H(this,void 0x0,void 0x0,function(){return V(this,function(E){return this['params']=J||{},!F&&K&&(F=(null==K?void 0x0:K['width'])/(null==K?void 0x0:K['height'])),this['setupVideo'](K||this['videoSize'],F||this['videoRatio']),this['emit']('init',!0x0),[0x2,!0x0];});});},A['prototype']['reset']=function(){this['emit']('reset');},A['prototype']['dispose']=function(){},A['prototype']['setupVideo']=function(J,K){K=K||J['width']/J['height'],this['videoSize']=G({},J),this['videoRatio']=K,this['cameraRatio']=K;},A;}(D),k=function(Y){function A(J,K,F,E,P){void 0x0===K&&(K='crop'),void 0x0===F&&(F=0x1),void 0x0===E&&(E=!0x1),void 0x0===P&&(P=0x1);var X=Y['call'](this)||this;X['container']=J,X['mode']=K,X['layerCount']=F,X['mirror']=E,X['aspectRatio']=P,X['layers']=[],X['setAspectRatio']=function(o2){X['aspectRatio']=o2,X['updateSizes'](X['container']['clientWidth']/X['container']['clientHeight']);},X['setMirror']=function(o2){X['mirror']=o2,X['layers']['forEach'](function(o3){o3['style']['transform']=o2?'scaleX(-1)':'';});},X['updateSizes']=function(o2){var o3=0x1,o4=0x1;o2>X['aspectRatio']?'fit'===X['mode']?o3=X['aspectRatio']/o2:o4=o2/X['aspectRatio']:'fit'===X['mode']?o4=o2/X['aspectRatio']:o3=X['aspectRatio']/o2;for(var o5=0x64*o3+'%',o6=0x64*o4+'%',o7=(0x1-o3)/0x2*0x64+'%',o8=(0x1-o4)/0x2*0x64+'%',o9=0x0,oo=X['layers'];o9<oo['length'];o9++){var oi=oo[o9];oi['style']['width']=o5,oi['style']['height']=o6,oi['style']['left']=o7,oi['style']['top']=o8;}X['emit']('resize');},X['handleResize']=function(o2){if(!(o2['length']<0x1)){var o3=o2[0x0]['contentBoxSize'][0x0];X['updateSizes'](o3['inlineSize']/o3['blockSize']);}};for(var o0=0x0;o0<F;o0++){var o1=document['createElement']('canvas');o1['id']='engeenee.canvas.layer'+o0,o1['style']['position']='absolute',o1['style']['zIndex']=-0xa*(F-o0)+'',X['mirror']&&(o1['style']['transform']='scaleX(-1)'),X['container']['appendChild'](o1),X['layers']['push'](o1);}return X['setAspectRatio'](P),X['observer']=new ResizeObserver(X['handleResize']),X['observer']['observe'](X['container']),X['container']['style']['overflow']='hidden',X;}return Z(A,Y),A;}(D),q=function(Y){function A(){var J=Y['call'](this)||this;return J['loaded']=!0x1,J['videoSize']={'width':0x780,'height':0x438},J['videoRatio']=J['videoSize']['width']/J['videoSize']['height'],J['cameraRatio']=J['videoRatio'],J['cameraAngle']=0x3c/0xb4*Math['PI'],J;}return Z(A,Y),A['prototype']['load']=function(){return H(this,void 0x0,void 0x0,function(){return V(this,function(J){return this['loaded']||(this['loaded']=!0x0,this['emit']('load')),[0x2];});});},A['prototype']['unload']=function(){this['loaded']&&(this['loaded']=!0x1);},A['prototype']['update']=function(J,K){return H(this,void 0x0,void 0x0,function(){return V(this,function(F){return this['loaded']?(this['emit']('render'),[0x2]):[0x2];});});},A['prototype']['dispose']=function(){this['unload']();},A['prototype']['setupVideo']=function(J,K){this['videoSize']=G({},J),this['videoRatio']=K||J['width']/J['height'],this['emit']('resize',this['videoSize'],this['videoRatio']);},A['prototype']['setupCamera']=function(J,K){this['cameraRatio']=J,this['cameraAngle']=K;},A;}(D),N=function(Y){function A(J){var K=Y['call'](this)||this;return K['canvas']=new k(J['container'],J['mode'],J['layerCount'],J['mirror'],J['aspectRatio']),K;}return Z(A,Y),A['prototype']['setupVideo']=function(J,K){Y['prototype']['setupVideo']['call'](this,J,K),this['canvas']['setAspectRatio'](this['videoRatio']);},A['prototype']['setMirror']=function(J){this['canvas']['setMirror'](J);},A;}(q),R=function(Y){function A(J){var K=Y['call'](this,J)||this;K['videoCtx']=null;var F=K['canvas']['layers'][0x0];return K['videoCtx']=F['getContext']('2d'),K;}return Z(A,Y),A['prototype']['update']=function(J,K){return H(this,void 0x0,void 0x0,function(){return V(this,function(F){return this['updateVideo'](K),[0x2,Y['prototype']['update']['call'](this,J,K)];});});},A['prototype']['updateVideo']=function(J){var K=this['videoCtx'];if(K){var F=this['videoSize'],E=F['width'],P=F['height'];K['clearRect'](0x0,0x0,E,P),K['drawImage'](J,0x0,0x0);}},A['prototype']['setupVideo']=function(J,K){Y['prototype']['setupVideo']['call'](this,J,K),this['canvas']['layers'][0x0]['width']=this['videoSize']['width'],this['canvas']['layers'][0x0]['height']=this['videoSize']['height'];},A;}(N),C=(function(){function Y(){this['loaded']=!0x1;}return Y['prototype']['load']=function(A){return H(this,void 0x0,void 0x0,function(){return V(this,function(J){return this['loaded']||!A||(this['scene']=A,this['loaded']=!0x0),[0x2];});});},Y['prototype']['unload']=function(){this['loaded']&&(delete this['scene'],this['loaded']=!0x1);},Y['prototype']['update']=function(A,J){return H(this,void 0x0,void 0x0,function(){return V(this,function(K){return this['loaded'],[0x2];});});},Y['prototype']['dispose']=function(){this['unload']();},Y;}()),O=function(Y){function A(J){var K=Y['call'](this,J)||this;return K['plugins']=[],K;}return Z(A,Y),A['prototype']['load']=function(){return H(this,void 0x0,void 0x0,function(){var J=this;return V(this,function(K){switch(K['label']){case 0x0:return this['loaded']?[0x2]:[0x4,Promise['all'](this['plugins']['map'](function(F){return F['load'](J['scene']);}))];case 0x1:return K['sent'](),[0x4,Y['prototype']['load']['call'](this)];case 0x2:return K['sent'](),[0x2];}});});},A['prototype']['unload']=function(){this['plugins']['forEach'](function(J){return J['unload']();}),Y['prototype']['unload']['call'](this);},A['prototype']['update']=function(J,K){return H(this,void 0x0,void 0x0,function(){var F=this;return V(this,function(E){switch(E['label']){case 0x0:return this['updateVideo'](K),[0x4,Promise['all'](this['plugins']['map'](function(P){return P instanceof C?P['update'](J,K):P['update'](J,K,F['videoCtx']);}))];case 0x1:return E['sent'](),this['updateScene'](),[0x2,N['prototype']['update']['call'](this,J,K)];}});});},A['prototype']['updateScene']=function(){},A['prototype']['dispose']=function(){this['plugins']['forEach'](function(J){return J['dispose']();}),this['plugins']=[],delete this['scene'],Y['prototype']['dispose']['call'](this);},A['prototype']['addPlugin']=function(J){return H(this,void 0x0,void 0x0,function(){return V(this,function(K){switch(K['label']){case 0x0:return!this['loaded']||J['loaded']?[0x3,0x2]:[0x4,J['load'](this['scene'])];case 0x1:K['sent'](),K['label']=0x2;case 0x2:return this['plugins']['push'](J),[0x2];}});});},A['prototype']['removePlugin']=function(J){var K=this['plugins'],F=K['indexOf'](J);F<0x0||(K[F]['dispose'](),K['splice'](F,0x1));},A;}(R),U=(function(){function Y(){this['loaded']=!0x1;}return Y['prototype']['load']=function(){return H(this,void 0x0,void 0x0,function(){return V(this,function(A){return this['loaded']||(this['loaded']=!0x0),[0x2];});});},Y['prototype']['unload']=function(){this['loaded']&&(this['loaded']=!0x1);},Y['prototype']['update']=function(A,J,K){return H(this,void 0x0,void 0x0,function(){return V(this,function(F){return this['loaded'],[0x2];});});},Y['prototype']['dispose']=function(){this['unload']();},Y;}()),b=(function(){function Y(A,J,K,F){void 0x0===J&&(J=!0x1),void 0x0===K&&(K='video'),this['renderer']=A,this['mirror']=J,this['sizeMode']=K,this['sizeMax']=F;}return Y['prototype']['snapshot']=function(){return H(this,void 0x0,void 0x0,function(){var A=this;return V(this,function(J){return[0x2,new Promise(function(K){A['renderer']['once']('render',function(){var F=A['renderer'],E=F['canvas']['layers'],P=F['canvas']['layers'][0x0],X=P['width'],o0=P['height'];'max'===A['sizeMode']?(X=Math['max']['apply'](Math,E['map'](function(o4){return o4['width'];})),o0=Math['max']['apply'](Math,E['map'](function(o4){return o4['height'];}))):'min'===A['sizeMode']&&(X=Math['min']['apply'](Math,E['map'](function(o4){return o4['width'];})),o0=Math['min']['apply'](Math,E['map'](function(o4){return o4['height'];})));var o1=document['createElement']('canvas');o1['id']='engeenee.snapshot',o1['hidden']=!0x0,o1['width']=X,o1['height']=o0;var o2=o1['getContext']('2d',{'alpha':!0x0});if(o2){A['mirror']&&(o2['translate'](X,0x0),o2['scale'](-0x1,0x1)),E['forEach'](function(o4){return o2['drawImage'](o4,0x0,0x0,X,o0);});var o3=o2['getImageData'](0x0,0x0,X,o0);o1['remove'](),K(o3);}});})];});});},Y['prototype']['snapshotLayers']=function(){return H(this,void 0x0,void 0x0,function(){var A=this;return V(this,function(J){return[0x2,new Promise(function(K){A['renderer']['once']('render',function(){var F=document['createElement']('canvas');F['id']='engeenee.snapshot',F['hidden']=!0x0;var E=F['getContext']('2d',{'alpha':!0x0});if(E){var P=A['renderer']['canvas']['layers']['map'](function(X){var o0=X['width'],o1=X['height'];return F['width']=o0,F['height']=o1,E['resetTransform'](),A['mirror']&&(E['translate'](o0,0x0),E['scale'](-0x1,0x1)),E['drawImage'](X,0x0,0x0),E['getImageData'](0x0,0x0,o0,o1);});F['remove'](),K(P);}});})];});});},Y;}()),j=(function(){function Y(A,J,K,F,E,P){void 0x0===J&&(J='video/webm'),void 0x0===K&&(K=!0x1),void 0x0===F&&(F='video');var X=this;this['renderer']=A,this['type']=J,this['mirror']=K,this['sizeMode']=F,this['sizeMax']=E,this['bitRate']=P,this['context']=null,this['records']=[],this['frame']=function(){var o0,o1=X,o2=o1['renderer'],o3=o1['context'],o4=o1['stream'],o5=X['canvas'],o6=o5['width'],o7=o5['height'];o4&&o3&&(o2['canvas']['layers']['map'](function(o8){return o3['drawImage'](o8,0x0,0x0,o6,o7);}),null===(o0=o4['getVideoTracks']()[0x0])||void 0x0===o0||o0['requestFrame']());},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}return Y['prototype']['start']=function(){var A=this,J=this,K=J['canvas'],F=J['context'],E=J['renderer'];if(!K||!F)return!0x1;var P=E['canvas']['layers'],X=P[0x0],o0=X['width'],o1=X['height'];'max'===this['sizeMode']?(o0=Math['max']['apply'](Math,P['map'](function(o4){return o4['width'];})),o1=Math['max']['apply'](Math,P['map'](function(o4){return o4['height'];}))):'min'===this['sizeMode']&&(o0=Math['min']['apply'](Math,P['map'](function(o4){return o4['width'];})),o1=Math['min']['apply'](Math,P['map'](function(o4){return o4['height'];})));var o2=Math['max'](o0,o1);if(this['sizeMax']&&o2>this['sizeMax']){var o3=this['sizeMax']/o2;o0*=o3,o1*=o3;}return K['width']=o0,K['height']=o1,F['resetTransform'](),this['mirror']&&(F['translate'](o0,0x0),F['scale'](-0x1,0x1)),E['on']('render',this['frame']),this['records']=[],this['stream']=K['captureStream'](0x0),this['recorder']=new MediaRecorder(this['stream'],{'mimeType':this['type'],'videoBitsPerSecond':this['bitRate']}),this['recorder']['ondataavailable']=function(o4){return A['records']['push'](o4['data']);},this['recorder']['start'](),!0x0;},Y['prototype']['stop']=function(){return H(this,void 0x0,void 0x0,function(){var A,J=this;return V(this,function(K){return(A=this['recorder'])&&'recording'==A['state']?[0x2,new Promise(function(F){A['onstop']=function(){var E;F(new Blob(J['records'],{'type':J['type']})),J['records']=[],null===(E=J['stream'])||void 0x0===E||E['getVideoTracks']()['forEach'](function(P){return P['stop']();}),J['renderer']['removeListener']('render',J['frame']),delete J['stream'],delete J['recorder'];},A['stop']();})]:[0x2];});});},Y['prototype']['dispose']=function(){this['canvas']['remove']();},Y;}()),T=(function(){function Y(A,J){void 0x0===J&&(J=!0x1);var K=this;this['renderer']=A,this['mirror']=J,this['context']=null,this['render']=function(){var F=K,E=F['canvas'],P=F['context'];E&&P&&K['renderer']['canvas']['layers']['map'](function(X){return P['drawImage'](X,0x0,0x0,E['width'],E['height']);});},this['canvas']=document['createElement']('canvas'),this['canvas']['id']='engeenee.record',this['canvas']['hidden']=!0x0,this['mirror']&&(this['canvas']['style']['transform']='scaleX(-1)'),this['context']=this['canvas']['getContext']('2d',{'alpha':!0x1});}return Y['prototype']['start']=function(){var A=this['canvas'],J=this['context'];if(!A||!J)return!0x1;var K=this['renderer']['canvas']['layers'][0x0],F=K['width'],E=K['height'];return A['width']=F,A['height']=E,this['renderer']['on']('render',this['render']),this['stream']=A['captureStream'](),!0x0;},Y['prototype']['pause']=function(){this['renderer']['removeListener']('render',this['render']);},Y['prototype']['mediaStream']=function(){return this['stream'];},Y;}());export{I as AsyncEngine,N as CanvasRenderer,L as CaptureContext,M as Engine,D as EventEmitterT,W as Processor,j as Recorder,q as Renderer,k as ResponsiveCanvas,C as ScenePlugin,O as SceneRenderer,b as Snapshoter,T as Streamer,Q as VideoCapture,U as VideoPlugin,R as VideoRenderer};
