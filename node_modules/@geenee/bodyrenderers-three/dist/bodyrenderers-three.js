import{SceneRenderer as G,ScenePlugin as T,VideoPlugin as x}from'@geenee/armature';import*as J from'three';import{meshTriangles as Y,meshUV as O,meshDesc as H}from'@geenee/bodytracking';var M=function(m0,m1){return M=Object['setPrototypeOf']||{'__proto__':[]}instanceof Array&&function(m2,m3){m2['__proto__']=m3;}||function(m2,m3){for(var m4 in m3)Object['prototype']['hasOwnProperty']['call'](m3,m4)&&(m2[m4]=m3[m4]);},M(m0,m1);};function E(m0,m1){if('function'!=typeof m1&&null!==m1)throw new TypeError('Class\x20extends\x20value\x20'+String(m1)+'\x20is\x20not\x20a\x20constructor\x20or\x20null');function m2(){this['constructor']=m0;}M(m0,m1),m0['prototype']=null===m1?Object['create'](m1):(m2['prototype']=m1['prototype'],new m2());}function D(m0,m1,m2,m3){return new(m2||(m2=Promise))(function(m4,m5){function m6(m9){try{m8(m3['next'](m9));}catch(mm){m5(mm);}}function m7(m9){try{m8(m3['throw'](m9));}catch(mm){m5(mm);}}function m8(m9){var mm;m9['done']?m4(m9['value']):(mm=m9['value'],mm instanceof m2?mm:new m2(function(mG){mG(mm);}))['then'](m6,m7);}m8((m3=m3['apply'](m0,m1||[]))['next']());});}function Q(m0,m1){var m2,m3,m4,m5,m6={'label':0x0,'sent':function(){if(0x1&m4[0x0])throw m4[0x1];return m4[0x1];},'trys':[],'ops':[]};return m5={'next':m7(0x0),'throw':m7(0x1),'return':m7(0x2)},'function'==typeof Symbol&&(m5[Symbol['iterator']]=function(){return this;}),m5;function m7(m8){return function(m9){return function(mm){if(m2)throw new TypeError('Generator\x20is\x20already\x20executing.');for(;m6;)try{if(m2=0x1,m3&&(m4=0x2&mm[0x0]?m3['return']:mm[0x0]?m3['throw']||((m4=m3['return'])&&m4['call'](m3),0x0):m3['next'])&&!(m4=m4['call'](m3,mm[0x1]))['done'])return m4;switch(m3=0x0,m4&&(mm=[0x2&mm[0x0],m4['value']]),mm[0x0]){case 0x0:case 0x1:m4=mm;break;case 0x4:return m6['label']++,{'value':mm[0x1],'done':!0x1};case 0x5:m6['label']++,m3=mm[0x1],mm=[0x0];continue;case 0x7:mm=m6['ops']['pop'](),m6['trys']['pop']();continue;default:if(!(m4=m6['trys'],(m4=m4['length']>0x0&&m4[m4['length']-0x1])||0x6!==mm[0x0]&&0x2!==mm[0x0])){m6=0x0;continue;}if(0x3===mm[0x0]&&(!m4||mm[0x1]>m4[0x0]&&mm[0x1]<m4[0x3])){m6['label']=mm[0x1];break;}if(0x6===mm[0x0]&&m6['label']<m4[0x1]){m6['label']=m4[0x1],m4=mm;break;}if(m4&&m6['label']<m4[0x2]){m6['label']=m4[0x2],m6['ops']['push'](mm);break;}m4[0x2]&&m6['ops']['pop'](),m6['trys']['pop']();continue;}mm=m1['call'](m0,m6);}catch(mG){mm=[0x6,mG],m3=0x0;}finally{m2=m4=0x0;}if(0x5&mm[0x0])throw mm[0x1];return{'value':mm[0x0]?mm[0x1]:void 0x0,'done':!0x0};}([m8,m9]);};}}function I(m0,m1,m2){if(m2||0x2===arguments['length']){for(var m3,m4=0x0,m5=m1['length'];m4<m5;m4++)!m3&&m4 in m1||(m3||(m3=Array['prototype']['slice']['call'](m1,0x0,m4)),m3[m4]=m1[m4]);}return m0['concat'](m3||Array['prototype']['slice']['call'](m1));}var A=function(m0){function m1(m2,m3,m4){var m5=m0['call'](this,{'container':m2,'mode':m3,'layerCount':0x2,'mirror':m4})||this;m5['cameraAngle']=0xa/0xb4*Math['PI'];var m6=m5['canvas']['layers'][0x1];return m5['renderer']=new J['WebGLRenderer']({'canvas':m6,'alpha':!0x0,'preserveDrawingBuffer':!0x0}),m5['renderer']['setClearColor'](0x0,0x0),m5['renderer']['setPixelRatio'](window['devicePixelRatio']),m5['renderer']['setSize'](m6['clientWidth'],m6['clientHeight']),m5['renderer']['physicallyCorrectLights']=!0x0,m5['renderer']['outputEncoding']=J['sRGBEncoding'],m5['canvas']['on']('resize',function(){m5['renderer']['setSize'](m6['clientWidth'],m6['clientHeight']);}),m5['scene']=new J['Scene'](),m5['scene']['background']=null,m5['camera']=new J['PerspectiveCamera'](m5['cameraAngle'],0x1,0.02,0x14),m5;}return E(m1,m0),m1['prototype']['updateScene']=function(){this['scene']&&this['renderer']['render'](this['scene'],this['camera']);},m1['prototype']['setupCamera']=function(m2,m3){m0['prototype']['setupCamera']['call'](this,m2,m3),this['camera']instanceof J['PerspectiveCamera']&&(this['camera']['aspect']=this['cameraRatio'],this['camera']['fov']=this['cameraAngle']/Math['PI']*0xb4,this['camera']['updateProjectionMatrix']());},m1['prototype']['setupVideo']=function(m2,m3){m0['prototype']['setupVideo']['call'](this,m2,m3),this['camera']instanceof J['OrthographicCamera']&&(this['camera']['right']=this['videoSize']['width'],this['camera']['bottom']=this['videoSize']['height'],this['camera']['updateProjectionMatrix']());},m1['prototype']['disposeObject']=function(m2){m2['removeFromParent'](),m2['traverse'](function(m3){var m4,m5;m3 instanceof J['Mesh']&&(m3['geometry']instanceof J['BufferGeometry']&&m3['geometry']['dispose'](),m3['material']instanceof J['Material']&&m3['material']['dispose'](),m4=m3['material'],m5=J['Material'],Array['isArray'](m4)&&m4['every'](function(m6){return m6 instanceof m5;})&&m3['material']['forEach'](function(m6){for(var m7 in(m6['dispose'](),m6)){var m8=m6[m7];m8 instanceof J['Texture']&&m8['dispose']();}}));});},m1;}(G),X=function(m0){function m1(){return null!==m0&&m0['apply'](this,arguments)||this;}return E(m1,m0),m1;}(T),N=function(m0){function m1(){return null!==m0&&m0['apply'](this,arguments)||this;}return E(m1,m0),m1;}(A),F=function(m0){function m1(){return null!==m0&&m0['apply'](this,arguments)||this;}return E(m1,m0),m1;}(X),V=function(m0){function m1(){return null!==m0&&m0['apply'](this,arguments)||this;}return E(m1,m0),m1;}(A),W=function(m0){function m1(){return null!==m0&&m0['apply'](this,arguments)||this;}return E(m1,m0),m1;}(X),K=function(m0){function m1(m2,m3){void 0x0===m3&&(m3=!0x1);var m4=m0['call'](this)||this;return m4['node']=m2,m4['shapeScale']=m3,m4;}return E(m1,m0),m1['prototype']['update']=function(m2,m3){return D(this,void 0x0,void 0x0,function(){var m4,m5,m6,m7,m8,m9,mm,mG;return Q(this,function(mT){return this['loaded']?(m4=m2['transform'])?(m5=new((m9=J['Vector3'])['bind']['apply'](m9,I([void 0x0],m4['translation'],!0x1)))(),m6=new J['Vector3']()['setScalar'](m4['scale']),m7=new((mm=J['Vector3'])['bind']['apply'](mm,I([void 0x0],m4['shapeScale'],!0x1)))()['multiplyScalar'](m4['scale']),m8=new((mG=J['Quaternion'])['bind']['apply'](mG,I([void 0x0],m4['rotation'],!0x1)))(),this['node']['visible']=!0x0,this['node']['setRotationFromQuaternion'](m8),this['node']['position']['copy'](m5),this['node']['scale']['copy'](this['shapeScale']?m7:m6),[0x2,m0['prototype']['update']['call'](this,m2,m3)]):(this['node']['visible']=!0x1,[0x2,m0['prototype']['update']['call'](this,m2,m3)]):[0x2];});});},m1;}(X),j=function(m0){function m1(m2,m3,m4){void 0x0===m3&&(m3=0x0),void 0x0===m4&&(m4=!0x1);var m5=m0['call'](this)||this;return m5['node']=m2,m5['facePoint']=m3,m5['shapeScale']=m4,m5;}return E(m1,m0),m1['prototype']['update']=function(m2,m3){return D(this,void 0x0,void 0x0,function(){var m4,m5,m6,m7,m8,m9,mm,mG,mT;return Q(this,function(mx){return this['loaded']?this['node']?(m4=m2['transform'],m5=m2['metric'],m4&&m5?(m6=new((mm=J['Vector3'])['bind']['apply'](mm,I([void 0x0],m5[this['facePoint']],!0x1)))(),m7=new J['Vector3']()['setScalar'](m4['scale']),m8=new((mG=J['Vector3'])['bind']['apply'](mG,I([void 0x0],m4['shapeScale'],!0x1)))()['multiplyScalar'](m4['scale']),m9=new((mT=J['Quaternion'])['bind']['apply'](mT,I([void 0x0],m4['rotation'],!0x1)))(),this['node']['visible']=!0x0,this['node']['setRotationFromQuaternion'](m9),this['node']['position']['copy'](m6),this['node']['scale']['copy'](this['shapeScale']?m8:m7),[0x2,m0['prototype']['update']['call'](this,m2,m3)]):(this['node']['visible']=!0x1,[0x2,m0['prototype']['update']['call'](this,m2,m3)])):[0x2,m0['prototype']['update']['call'](this,m2,m3)]:[0x2];});});},m1;}(X),z=function(m0){function m1(m2){var m3=m0['call'](this)||this;return m3['url']=m2,m3;}return E(m1,m0),m1['prototype']['load']=function(m2){return D(this,void 0x0,void 0x0,function(){var m3,m4,m5;return Q(this,function(m6){return this['loaded']||!m2?[0x2]:((m3=new J['BufferGeometry']())['setIndex'](Y),m3['setAttribute']('position',new J['Float32BufferAttribute'](new Float32Array(0x57c),0x3)),m3['setAttribute']('uv',new J['Float32BufferAttribute'](O['flat'](),0x2)),m3['computeVertexNormals'](),(m4=new J['TextureLoader']()['load'](this['url']))['flipY']=!0x1,m5=new J['MeshStandardMaterial']({'map':m4,'transparent':!0x0}),this['mask']=new J['Mesh'](m3,m5),m2['add'](this['mask']),[0x2,m0['prototype']['load']['call'](this,m2)]);});});},m1['prototype']['unload']=function(){var m2,m3,m4,m5,m6;this['loaded']&&(null===(m2=this['mask'])||void 0x0===m2||m2['removeFromParent'](),null===(m3=this['mask'])||void 0x0===m3||m3['geometry']['dispose'](),null===(m5=null===(m4=this['mask'])||void 0x0===m4?void 0x0:m4['material']['map'])||void 0x0===m5||m5['dispose'](),null===(m6=this['mask'])||void 0x0===m6||m6['material']['dispose'](),delete this['mask'],m0['prototype']['unload']['call'](this));},m1['prototype']['update']=function(m2,m3){return D(this,void 0x0,void 0x0,function(){var m4,m5;return Q(this,function(m6){return this['loaded']?this['mask']?(m4=m2['metric'])?(this['mask']['visible']=!0x0,m5=this['mask']['geometry']['getAttribute']('position'),m4['forEach'](function(m7,m8){return m5['setXYZ'](m8,m7[0x0],m7[0x1],m7[0x2]);}),this['mask']['geometry']['computeVertexNormals'](),m5['needsUpdate']=!0x0,[0x2,m0['prototype']['update']['call'](this,m2,m3)]):(this['mask']['visible']=!0x1,[0x2,m0['prototype']['update']['call'](this,m2,m3)]):[0x2,m0['prototype']['update']['call'](this,m2,m3)]:[0x2];});});},m1;}(X),q=function(m0){function m1(){return null!==m0&&m0['apply'](this,arguments)||this;}return E(m1,m0),m1['prototype']['update']=function(m2,m3,m4){return D(this,void 0x0,void 0x0,function(){var m5,m6,m7,m8,m9,mm,mG,mT,mx,mJ,mY,mp,mu,mO;return Q(this,function(mB){if(!(m5=m2['mesh']))return[0x2,m0['prototype']['update']['call'](this,m2,m3,m4)];for(m6=m4['canvas'],m7=m6['width'],m8=m6['height'],m5['keypoints']['forEach'](function(mL){return m4['fillRect'](mL[0x0]*m7-0x2,mL[0x1]*m8-0x2,0x4,0x4);}),m4['lineWidth']=0x4,m4['strokeStyle']='rgba(93,\x20111,\x20227,\x200.75)',m9=I([],H['lipsLowerOuter'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['lipsUpperOuter'],!0x0),m9,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),mm=I([],H['lipsLowerInner'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['lipsUpperInner'],!0x0),mm,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),m4['strokeStyle']='rgba(172,\x20110,\x20255,\x200.75)',mG=I([],H['rightEyeLower0'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['rightEyeUpper0'],!0x0),mG,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),mT=I([],H['rightEyeLower1'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['rightEyeUpper1'],!0x0),mT,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),mx=I([],H['leftEyeLower0'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['leftEyeUpper0'],!0x0),mx,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),mJ=I([],H['leftEyeLower1'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['leftEyeUpper1'],!0x0),mJ,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),m4['strokeStyle']='rgba(94,\x20214,\x20202,\x200.75)',mY=I([],H['rightEyebrowLower'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['rightEyebrowUpper'],!0x0),mY,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),mp=I([],H['leftEyebrowLower'],!0x0)['reverse'](),this['drawPath'](m4,I(I([],H['leftEyebrowUpper'],!0x0),mp,!0x0)['map'](function(mL){return m5['keypoints'][mL];}),!0x0),m4['lineWidth']=0.5,m4['strokeStyle']='rgba(180,\x20180,\x20180,\x200.75)',mu=0x0;mu<Y['length']/0x3;mu++)mO=[Y[0x3*mu],Y[0x3*mu+0x1],Y[0x3*mu+0x2]]['map'](function(mL){return m5['keypoints'][mL];}),this['drawPath'](m4,mO,!0x0);return[0x2,m0['prototype']['update']['call'](this,m2,m3,m4)];});});},m1['prototype']['drawPath']=function(m2,m3,m4){var m5=m2['canvas'],m6=m5['width'],m7=m5['height'],m8=new Path2D();m8['moveTo'](m3[0x0][0x0]*m6,m3[0x0][0x1]*m7);for(var m9=0x1;m9<m3['length'];m9++)m8['lineTo'](m3[m9][0x0]*m6,m3[m9][0x1]*m7);m4&&m8['closePath'](),m2['stroke'](m8);},m1;}(x),U=function(m0){function m1(m2,m3){void 0x0===m3&&(m3={'spineCurve':0.5,'neckAdjust':0.01,'headRatio':0.32,'shoulderDY':-0.01,'shoulderDZ':0.005});var m4=m0['call'](this)||this;return m4['node']=m2,m4['tune']=m3,m4['avatarLength']=0x1,m4['alignScore']=0.9,m4['alignVisibility']=0.9,m4;}return E(m1,m0),m1['prototype']['load']=function(m2){return D(this,void 0x0,void 0x0,function(){return Q(this,function(m3){switch(m3['label']){case 0x0:return this['loaded']||!m2?[0x2]:[0x4,m0['prototype']['load']['call'](this,m2)];case 0x1:return m3['sent'](),[0x4,this['setNode'](this['node'])];case 0x2:return m3['sent'](),[0x2];}});});},m1['prototype']['unload']=function(){this['loaded']&&(delete this['node'],delete this['skeleton'],delete this['skeletonRef'],delete this['spineRef'],m0['prototype']['unload']['call'](this));},m1['prototype']['setNode']=function(m2){var m3;return D(this,void 0x0,void 0x0,function(){var m4,m5,m6,m7,m8,m9,mm,mG,mT,mx,mJ,mY,mp,mu,mO,mB,mL,mH,mk,md,mR,mM,mE=this;return Q(this,function(mf){return delete this['skeleton'],delete this['skeletonRef'],delete this['spineRef'],this['node']=m2,this['loaded']&&m2?(m2['traverse'](function(mD){!mE['skeletonRef']&&mD instanceof J['SkinnedMesh']&&(mE['skeletonRef']=mD['skeleton']);}),(m4=null===(m3=this['skeletonRef'])||void 0x0===m3?void 0x0:m3['bones'])?(m5={'hips':m4['find'](function(mD){return mD['name']['endsWith']('Hips');}),'spine':m4['find'](function(mD){return mD['name']['endsWith']('Spine');}),'spine1':m4['find'](function(mD){return mD['name']['endsWith']('Spine1');}),'spine2':m4['find'](function(mD){return mD['name']['endsWith']('Spine2');}),'neck':m4['find'](function(mD){return mD['name']['endsWith']('Neck');}),'head':m4['find'](function(mD){return mD['name']['endsWith']('Head');}),'headEnd':m4['find'](function(mD){return mD['name']['endsWith']('HeadTop_End');}),'shoulderL':m4['find'](function(mD){return mD['name']['endsWith']('LeftShoulder');}),'shoulderR':m4['find'](function(mD){return mD['name']['endsWith']('RightShoulder');}),'armL':m4['find'](function(mD){return mD['name']['endsWith']('LeftArm');}),'armR':m4['find'](function(mD){return mD['name']['endsWith']('RightArm');}),'foreArmL':m4['find'](function(mD){return mD['name']['endsWith']('LeftForeArm');}),'foreArmR':m4['find'](function(mD){return mD['name']['endsWith']('RightForeArm');}),'handL':m4['find'](function(mD){return mD['name']['endsWith']('LeftHand');}),'handR':m4['find'](function(mD){return mD['name']['endsWith']('RightHand');}),'upLegL':m4['find'](function(mD){return mD['name']['endsWith']('LeftUpLeg');}),'upLegR':m4['find'](function(mD){return mD['name']['endsWith']('RightUpLeg');}),'legL':m4['find'](function(mD){return mD['name']['endsWith']('LeftLeg');}),'legR':m4['find'](function(mD){return mD['name']['endsWith']('RightLeg');}),'footL':m4['find'](function(mD){return mD['name']['endsWith']('LeftFoot');}),'footR':m4['find'](function(mD){return mD['name']['endsWith']('RightFoot');}),'toeL':m4['find'](function(mD){return mD['name']['endsWith']('LeftToeBase');}),'toeR':m4['find'](function(mD){return mD['name']['endsWith']('RightToeBase');})},this['skeleton']=m5,m6=m5['hips']['getWorldPosition'](new J['Vector3']()),m7=m5['armL']['getWorldPosition'](new J['Vector3']()),m8=m5['armR']['getWorldPosition'](new J['Vector3']()),m9=m7['clone']()['lerp'](m8,0.5)['sub'](m6),mm=m9['length'](),mG=m7['clone']()['sub'](m6),mT=m8['clone']()['sub'](m6),mx=mT['clone']()['cross'](mG)['normalize'](),mJ=m5['spine']['getWorldPosition'](new J['Vector3']())['sub'](m6),mY=mJ['dot'](mx),mp=mJ['clone']()['sub'](mx['clone']()['multiplyScalar'](mY))['length'](),mu=m5['spine1']['getWorldPosition'](new J['Vector3']())['sub'](m6),mO=mu['dot'](mx),mB=mu['clone']()['sub'](mx['clone']()['multiplyScalar'](mO))['length'](),mL=m5['spine2']['getWorldPosition'](new J['Vector3']())['sub'](m6),mH=mL['dot'](mx),mk=mL['clone']()['sub'](mx['clone']()['multiplyScalar'](mH))['length'](),md=m5['head']['getWorldPosition'](new J['Vector3']()),mR=m5['headEnd']['getWorldPosition'](new J['Vector3']()),mM=mR['clone']()['sub'](md)['length'](),this['avatarLength']=mm,this['spineRef']={'spine':[mp/mm,mY/mm],'spine1':[mB/mm,mO/mm],'spine2':[mk/mm,mH/mm],'head':[mM/mm,0x0]},m2['traverse'](function(mD){mD['frustumCulled']=!0x1;}),[0x2]):[0x2]):[0x2];});});},m1['prototype']['update']=function(m2,m3){var m4;return D(this,void 0x0,void 0x0,function(){var m5,m6,m7,m8,m9,mm;return Q(this,function(mG){return m5=m2['poses']['length']>0x0?m2['poses'][0x0]['points']:void 0x0,m7=(m6=this)['node'],m8=m6['skeleton'],m9=m6['spineRef'],m7?m8&&m9&&m5?(mm=this['estimateBones'](m5,m9),m7['visible']=!0x0,null===(m4=this['skeletonRef'])||void 0x0===m4||m4['pose'](),this['updateSpine'](mm),this['updateHandL'](mm,m5),this['updateHandR'](mm,m5),this['updateLegL'](mm,m5),this['updateLegR'](mm,m5),[0x2,m0['prototype']['update']['call'](this,m2,m3)]):(m7['visible']=!0x1,[0x2,m0['prototype']['update']['call'](this,m2,m3)]):[0x2,m0['prototype']['update']['call'](this,m2,m3)];});});},m1['prototype']['updateSpine']=function(m2){var m3,m4=this['skeleton'],m5=this['spineRef'];if(m4&&m5){this['alignBone'](m2['hips'],m4['hips'],!0x1),this['alignBone'](m2['spine'],m4['spine']),this['alignBone'](m2['spine1'],m4['spine1']),this['alignBone'](m2['spine2'],m4['spine2']),this['alignBone'](m2['neck'],m4['neck'],!0x1),this['alignBone'](m2['head'],m4['head'],!0x1);var m6=null===(m3=this['skeletonRef'])||void 0x0===m3?void 0x0:m3['bones']['find'](function(m9){return m9['name']['endsWith']('HeadEnd');});if(m6){var m7=m2['head'],m8=m2['headEnd']['position']['clone']()['sub'](m7['position'])['length']();m4['head']['scale']['setScalar'](1.05*m8/m6['position']['length']());}this['alignBone'](m2['shoulderL'],m4['shoulderL'],!0x1),this['alignBone'](m2['shoulderR'],m4['shoulderR'],!0x1);}},m1['prototype']['updateHandL']=function(m2,m3){var m4=this['skeleton'],m5=this['spineRef'];if(m4&&m5){var m6=this['alignScore'],m7=this['alignVisibility'];this['alignBone'](m2['armL'],m4['armL']),m3['elbowL']['score']<m6&&m3['elbowL']['visibility']<m7||(this['alignBone'](m2['foreArmL'],m4['foreArmL']),this['alignBone'](m2['handL'],m4['handL']),m4['handL']['scale']['setScalar'](0.95));}},m1['prototype']['updateHandR']=function(m2,m3){var m4=this['skeleton'];if(m4){var m5=this['alignScore'],m6=this['alignVisibility'];this['alignBone'](m2['armR'],m4['armR']),m3['elbowR']['score']<m5&&m3['elbowR']['visibility']<m6||(this['alignBone'](m2['foreArmR'],m4['foreArmR']),this['alignBone'](m2['handR'],m4['handR']),m4['handR']['scale']['setScalar'](0.95));}},m1['prototype']['updateLegL']=function(m2,m3){var m4=this['skeleton'];if(m4){var m5=this['alignScore'],m6=this['alignVisibility'];m3['hipL']['score']<m5&&m3['hipL']['visibility']<m6||(this['alignBone'](m2['upLegL'],m4['upLegL'],!0x1),m3['kneeL']['score']<m5&&m3['kneeL']['visibility']<m6||(this['alignBone'](m2['legL'],m4['legL']),m3['ankleL']['score']<m5&&m3['ankleL']['visibility']<m6||(this['alignBone'](m2['footL'],m4['footL']),this['alignBone'](m2['toeL'],m4['toeL']))));}},m1['prototype']['updateLegR']=function(m2,m3){var m4=this['skeleton'];if(m4){var m5=this['alignScore'],m6=this['alignVisibility'];m3['hipR']['score']<m5&&m3['hipR']['visibility']<m6||(this['alignBone'](m2['upLegR'],m4['upLegR'],!0x1),m3['kneeR']['score']<m5&&m3['kneeR']['visibility']<m6||(this['alignBone'](m2['legR'],m4['legR']),m3['ankleR']['score']<m5&&m3['ankleR']['visibility']<m6||(this['alignBone'](m2['footR'],m4['footR']),this['alignBone'](m2['toeR'],m4['toeR']))));}},m1['prototype']['estimateBones']=function(m2,m3){var m4,m5,m6,m7,m8,m9,mm,mG,mT,mx,mJ,mY,mp,mu,mO,mB,mL,mH,mk,md,mR,mM,mE,mf,mD=new((m4=J['Vector3'])['bind']['apply'](m4,I([void 0x0],m2['hipL']['metric'],!0x1)))(),mv=new((m5=J['Vector3'])['bind']['apply'](m5,I([void 0x0],m2['hipR']['metric'],!0x1)))(),mQ=mD['clone']()['lerp'](mv,0.5),ml=mD['clone']()['sub'](mv)['normalize'](),mn=ml['clone']()['negate'](),mr=new((m6=J['Vector3'])['bind']['apply'](m6,I([void 0x0],m2['shoulderL']['metric'],!0x1)))(),mI=new((m7=J['Vector3'])['bind']['apply'](m7,I([void 0x0],m2['shoulderR']['metric'],!0x1)))(),mb=new((m8=J['Vector3'])['bind']['apply'](m8,I([void 0x0],m2['elbowL']['metric'],!0x1)))(),my=new((m9=J['Vector3'])['bind']['apply'](m9,I([void 0x0],m2['elbowR']['metric'],!0x1)))(),mc=mr['clone']()['lerp'](mI,0.5),mg=mr['clone']()['sub'](mI)['normalize'](),mo=mr['clone']()['sub'](mQ),mA=mI['clone']()['sub'](mQ)['clone']()['cross'](mo)['normalize']();if(this['tune']['shoulderDX']||this['tune']['shoulderDY']||this['tune']['shoulderDZ']){var mw=mg['clone']()['multiplyScalar'](this['tune']['shoulderDX']||0x0),mh=mc['clone']()['sub'](mQ)['normalize']()['multiplyScalar'](this['tune']['shoulderDY']||0x0)['add'](mA['clone']()['multiplyScalar']((null===(mf=this['tune'])||void 0x0===mf?void 0x0:mf['shoulderDZ'])||0x0));mr['add'](mh)['add'](mw),mI['add'](mh)['add'](mw['clone']()['negate']());}var mX,mN=mr['clone']()['lerp'](mI,0.5),mi=mN['clone']()['sub'](mQ)['normalize'](),ms=mb['clone']()['sub'](mr)['normalize'](),mF=my['clone']()['sub'](mI)['normalize']();if(this['tune']['neckAdjust']){var mV=Math['abs'](mg['x']);mX=mi['clone']()['multiplyScalar'](mV*(mi['dot'](ms)*-this['tune']['neckAdjust']+mi['dot'](mF)*-this['tune']['neckAdjust'])),mN['add'](mX);}var mW=mN['clone']()['sub'](mQ)['length'](),mK=this['tune']['shoulderOffset']||0.2,mj=mN['clone']()['lerp'](mr,mK),mz=mN['clone']()['lerp'](mI,mK),mt=new((mm=J['Vector3'])['bind']['apply'](mm,I([void 0x0],m2['earL']['metric'],!0x1)))(),mS=new((mG=J['Vector3'])['bind']['apply'](mG,I([void 0x0],m2['earR']['metric'],!0x1)))(),mq=mt['clone']()['lerp'](mS,0.5),mU=new((mT=J['Vector3'])['bind']['apply'](mT,I([void 0x0],m2['nose']['metric'],!0x1)))(),mZ=mq['clone']()['sub'](mU)['normalize'](),mC=mt['clone']()['sub'](mS)['normalize'](),ma=mC['clone']()['cross'](mZ)['add'](mZ['clone']()['multiplyScalar'](0.05))['normalize'](),mP=this['tune']['headRatio']||0.32,G0=m3['head'][0x0]*mW,G1=mq['clone']()['add'](ma['clone']()['cross'](mC)['multiplyScalar'](0.025)),G2=G1['clone']()['add'](ma['clone']()['multiplyScalar'](-mP*G0)),G3=G1['clone']()['add'](ma['clone']()['multiplyScalar']((0x1-mP)*G0)),G4=G2['clone']()['lerp'](G3,0x2),G5=mg['clone']()['lerp'](mC,0.5),G6=mX?mr['clone']()['add'](mX):mr['clone'](),G7=mX?mI['clone']()['add'](mX):mI['clone'](),G8=mD['clone']()['lerp'](G6,m3['spine'][0x0]),G9=mv['clone']()['lerp'](G7,m3['spine'][0x0]),Gm=G8['clone']()['lerp'](G9,0.5),GG=G8['clone']()['sub'](G9),GT=mD['clone']()['lerp'](G6,m3['spine1'][0x0]),Gx=mv['clone']()['lerp'](G7,m3['spine1'][0x0]),GJ=GT['clone']()['lerp'](Gx,0.5),GY=GT['clone']()['sub'](Gx),Gp=mD['clone']()['lerp'](G6,m3['spine2'][0x0]),Gu=mv['clone']()['lerp'](G7,m3['spine2'][0x0]),GO=Gp['clone']()['lerp'](Gu,0.5),GB=GT['clone']()['sub'](Gu);if(this['tune']['spineCurve']){var GL=mr['clone']()['sub'](mQ),GH=mI['clone']()['sub'](mQ)['clone']()['cross'](GL)['normalize']();mV=this['tune']['spineCurve']*mW,(Gm['add'](GH['clone']()['multiplyScalar'](m3['spine'][0x1]*mV)),GJ['add'](GH['clone']()['multiplyScalar'](m3['spine1'][0x1]*mV)),GO['add'](GH['clone']()['multiplyScalar'](m3['spine2'][0x1]*mV)));}var Gk=new((mx=J['Vector3'])['bind']['apply'](mx,I([void 0x0],m2['wristL']['metric'],!0x1)))(),Gd=Gk['clone']()['sub'](mb)['normalize']()['clone']()['sub'](ms)['negate'](),GR=mA['clone'](),GM=Gd['clone']()['lerp'](GR,0.5),GE=new((mJ=J['Vector3'])['bind']['apply'](mJ,I([void 0x0],m2['indexL']['metric'],!0x1)))(),Gf=new((mY=J['Vector3'])['bind']['apply'](mY,I([void 0x0],m2['pinkyL']['metric'],!0x1)))(),GD=GE['clone']()['lerp'](Gf,0.5),Gv=Gf['clone']()['sub'](GE),GQ=new((mp=J['Vector3'])['bind']['apply'](mp,I([void 0x0],m2['wristR']['metric'],!0x1)))(),Gl=GQ['clone']()['sub'](my)['normalize']()['clone']()['sub'](mF),Gn=mA['clone']()['negate'](),Gr=Gl['clone']()['lerp'](Gn,0.5),GI=new((mu=J['Vector3'])['bind']['apply'](mu,I([void 0x0],m2['indexR']['metric'],!0x1)))(),Gb=new((mO=J['Vector3'])['bind']['apply'](mO,I([void 0x0],m2['pinkyR']['metric'],!0x1)))(),Gy=GI['clone']()['lerp'](Gb,0.5),Gc=GI['clone']()['sub'](Gb),Gg=new((mB=J['Vector3'])['bind']['apply'](mB,I([void 0x0],m2['kneeL']['metric'],!0x1)))(),Go=new((mL=J['Vector3'])['bind']['apply'](mL,I([void 0x0],m2['ankleL']['metric'],!0x1)))(),GA=new((mH=J['Vector3'])['bind']['apply'](mH,I([void 0x0],m2['footIndexL']['metric'],!0x1)))(),Gw=new((mk=J['Vector3'])['bind']['apply'](mk,I([void 0x0],m2['heelL']['metric'],!0x1)))(),Gh=Go['clone']()['sub'](Gg)['normalize'](),GX=GA['clone']()['sub'](Gw)['normalize'](),GN=Gh['clone']()['cross'](GX)['normalize'](),Gi=Gw['clone']()['lerp'](GA,0.8),Gs=mn['clone']()['lerp'](GN,0.2),GF=mn['clone']()['lerp'](GN,0.6),GV=new((md=J['Vector3'])['bind']['apply'](md,I([void 0x0],m2['kneeR']['metric'],!0x1)))(),GW=new((mR=J['Vector3'])['bind']['apply'](mR,I([void 0x0],m2['ankleR']['metric'],!0x1)))(),GK=new((mM=J['Vector3'])['bind']['apply'](mM,I([void 0x0],m2['footIndexR']['metric'],!0x1)))(),Gj=new((mE=J['Vector3'])['bind']['apply'](mE,I([void 0x0],m2['heelR']['metric'],!0x1)))(),Gz=GW['clone']()['sub'](GV)['normalize'](),Gt=GK['clone']()['sub'](Gj)['normalize'](),GS=Gz['clone']()['cross'](Gt)['normalize'](),Gq=Gj['clone']()['lerp'](GK,0.8),GU=mn['clone']()['lerp'](GS,0.2),GZ=mn['clone']()['lerp'](GS,0.6);return{'hips':this['estimateBone'](mQ,Gm,ml),'spine':this['estimateBone'](Gm,GJ,GG),'spine1':this['estimateBone'](GJ,GO,GY),'spine2':this['estimateBone'](GO,mN,GB),'neck':this['estimateBone'](mN,G2,G5),'head':this['estimateBone'](G2,G3,mC),'headEnd':this['estimateBone'](G3,G4,mC),'shoulderL':this['estimateBone'](mj,mr,GR),'armL':this['estimateBone'](mr,mb,GM),'foreArmL':this['estimateBone'](mb,Gk,Gd),'handL':this['estimateBone'](Gk,GD,Gv),'shoulderR':this['estimateBone'](mz,mI,Gn),'armR':this['estimateBone'](mI,my,Gr),'foreArmR':this['estimateBone'](my,GQ,Gl),'handR':this['estimateBone'](GQ,Gy,Gc),'upLegL':this['estimateBone'](mD,Gg,Gs),'legL':this['estimateBone'](Gg,Go,GF),'footL':this['estimateBone'](Go,Gi,GN),'toeL':this['estimateBone'](Gi,GA,GN),'upLegR':this['estimateBone'](mv,GV,GU),'legR':this['estimateBone'](GV,GW,GZ),'footR':this['estimateBone'](GW,Gq,GS),'toeR':this['estimateBone'](Gq,GK,GS)};},m1['prototype']['estimateBone']=function(m2,m3,m4){var m5=m3['clone']()['sub'](m2)['normalize'](),m6=m4['clone']()['normalize']()['cross'](m5)['normalize'](),m7=m5['clone']()['cross'](m6);return{'position':m2['clone'](),'rotation':new J['Quaternion']()['setFromRotationMatrix'](new J['Matrix4']()['makeBasis'](m7,m5,m6))};},m1['prototype']['alignBone']=function(m2,m3,m4){void 0x0===m4&&(m4=!0x0);var m5=m2['rotation']['clone'](),m6=m2['position']['clone']();m3['parent']&&(m5=m3['parent']['getWorldQuaternion'](new J['Quaternion']())['invert']()['multiply'](m5),m6['applyMatrix4'](m3['parent']['matrixWorld']['clone']()['invert']()),m4&&m3['parent']instanceof J['Bone']&&(m3['parent']['scale']['setScalar'](m6['length']()/m3['position']['length']()),m3['parent']['updateWorldMatrix'](!0x0,!0x0),m6=m2['position']['clone']()['applyMatrix4'](m3['parent']['matrixWorld']['clone']()['invert']()))),m3['setRotationFromQuaternion'](m5),m3['position']['copy'](m6),m3['updateWorldMatrix'](!0x0,!0x0);},m1;}(F),Z=function(m0){function m1(m2,m3,m4){void 0x0===m4&&(m4={'headRatio':0.35,'shoulderDY':0.005,'neckAdjust':0.01});var m5=m0['call'](this,m2,m4)||this;return m5['outfit']=m3,m5;}return E(m1,m0),m1['prototype']['setNode']=function(m2){return D(this,void 0x0,void 0x0,function(){var m3,m4,m5;return Q(this,function(m6){switch(m6['label']){case 0x0:return[0x4,m0['prototype']['setNode']['call'](this,m2)];case 0x1:return m6['sent'](),m4=(m3=this)['outfit'],m5=m3['node'],m4&&m5?(m5['traverse'](function(m7){if(m7 instanceof J['Mesh']){var m8=function(m9){return null==m9?void 0x0:m9['some'](function(mm){return'string'==typeof mm?m7['name']===mm:mm['test'](m7['name']);});};if(m8(m4['occluders']))return m7['material']['colorWrite']=!0x1,void(m7['renderOrder']=-0x1);m8(m4['hidden'])&&(m7['visible']=!0x1);}}),[0x2]):[0x2];}});});},m1['prototype']['setOutfit']=function(m2,m3){return D(this,void 0x0,void 0x0,function(){return Q(this,function(m4){return this['outfit']=m3,[0x2,this['setNode'](m2)];});});},m1;}(U),C=function(m0){function m1(m2,m3,m4,m5,m6){void 0x0===m6&&(m6={'headRatio':0.2});var m7=m0['call'](this,m2,m6)||this;return m7['translation']=m3,m7['rotation']=m4,m7['scale']=m5,m7;}return E(m1,m0),m1['prototype']['update']=function(m2,m3){return D(this,void 0x0,void 0x0,function(){var m4,m5,m6,m7,m8,m9,mm,mG,mT,mx,mJ;return Q(this,function(mY){switch(mY['label']){case 0x0:return[0x4,m0['prototype']['update']['call'](this,m2,m3)];case 0x1:return mY['sent'](),m4=m2['poses']['length']>0x0?m2['poses'][0x0]['points']:void 0x0,m6=(m5=this)['node'],m7=m5['translation'],m8=m5['rotation'],m9=m5['scale'],m6&&m4?(mm=new((mx=J['Vector3'])['bind']['apply'](mx,I([void 0x0],m4['hipL']['metric'],!0x1)))(),mG=new((mJ=J['Vector3'])['bind']['apply'](mJ,I([void 0x0],m4['hipR']['metric'],!0x1)))(),mT=mm['clone']()['lerp'](mG,0.5),m6['position']['copy'](m7?mT['add'](m7):mT),m8&&m6['setRotationFromQuaternion'](m6['quaternion']['multiply'](m8)),m9&&m6['scale']['setScalar'](m9),[0x2]):[0x2];}});});},m1['prototype']['updateSpine']=function(m2){var m3=this['skeleton'],m4=this['spineRef'];m3&&m4&&(this['alignBone'](m2['hips'],m3['hips']),this['alignBone'](m2['spine'],m3['spine']),this['alignBone'](m2['spine1'],m3['spine1']),this['alignBone'](m2['spine2'],m3['spine2']),this['alignBone'](m2['neck'],m3['neck']),this['alignBone'](m2['head'],m3['head']),this['alignBone'](m2['shoulderL'],m3['shoulderL']),this['alignBone'](m2['shoulderR'],m3['shoulderR']));},m1['prototype']['alignBone']=function(m2,m3){var m4=m2['rotation']['clone']();m3['parent']&&(m4=m3['parent']['getWorldQuaternion'](new J['Quaternion']())['invert']()['multiply'](m4)),m3['setRotationFromQuaternion'](m4),m3['updateWorldMatrix'](!0x0,!0x0);},m1;}(U),P=function(m0){function m1(m2,m3){void 0x0===m3&&(m3=-0x1);var m4=m0['call'](this)||this;return m4['node']=m2,m4['renderOrder']=m3,m4;}return E(m1,m0),m1['prototype']['load']=function(m2){return D(this,void 0x0,void 0x0,function(){var m3=this;return Q(this,function(m4){return this['loaded']||!m2?[0x2]:(this['node']['traverse'](function(m5){m5 instanceof J['Mesh']&&(m5['material']['colorWrite']=!0x1),m5['renderOrder']=m3['renderOrder'];}),[0x2,m0['prototype']['load']['call'](this,m2)]);});});},m1;}(X);export{q as FaceDebugPlugin,z as FaceMaskPlugin,W as FacePlugin,V as FaceRenderer,j as FaceTrackPlugin,K as HeadTrackPlugin,P as OccluderPlugin,U as PoseAlignPlugin,Z as PoseOutfitPlugin,F as PosePlugin,N as PoseRenderer,C as PoseTwinPlugin,X as ThreePlugin,A as ThreeRenderer};
